{{- if .Values.core.migration.process.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "identity.fullname" . }}-migration-configuration
data:
  application.yaml: |
    spring:
      profiles:
        active: process-migration
    {{ if .Values.global.elasticsearch.enabled }}
    camunda:
      connect:
        cluster-name: elasticsearch
        cluster-type: elasticsearch
      database:
        url: {{ include "camundaPlatform.elasticsearchURL" . | quote }}
        username: {{ .Values.global.elasticsearch.auth.username }}
        password: ${VALUES_DATABASE_PASSWORD:}
    {{ else }}
    camunda:
      connect:
        cluster-name: opensearch
        cluster-type: opensearch
      database:
        url: {{ include "camundaPlatform.opensearchURL" . | quote }}
        username: {{ .Values.global.opensearch.auth.username }}
        password: ${VALUES_DATABASE_PASSWORD:}
    {{- end }}
      migration:
        process:
          batch-size: 5
          import-finished-timeout: PT1M
          retry:
            max-retries: 5
            max-retry-delay: PT1M
            min-retry-delay: PT10S
            retry-delay-multiplier: 2.0
{{- end }}
